# Уровни переопределения

* [Определение](#)
* [Принцип работы уровней переопределения](#)
* [Задачи уровней переопределения](#)
* [Примеры использования уровней переопределения](#)

## Определение

Уровень переопределения — это директория в БЭМ-проекте, которая содержит файлы реализаций [блоков](../key-concepts/key-concepts.ru.md#Блок), [элементов](../key-concepts/key-concepts.ru.md#Элемент) и [модификаторов](../key-concepts/key-concepts.ru.md#Модификатор).


Уровни переопределения позволяют организовать разработку и поддержку проекта, чтобы:

полнее расписать с примерами
* Избежать дублирования кода благодаря разделению на общую и специфическую части на отдельные уровни.  непонятно
  Пример: Разделение проекта на платформы.
* Сократить время на отладку проекта. Исправить ошибку в общем коде нужно один раз, правки применятся во все проекты.
* Подключать сторонние библиотеки в проект и обновлять их, не делая правок в коде.
* Не создавать новые сущности, если необходимо изменить функциональность существующего блока. Возможность доопределения и переопределения блоков.
* Организовать архитектуру проекта, чтобы [ускорить разработку, поддержку и эксперименты](#Как-использовать-уровни-переопределения). 

## Принцип работы уровней переопределения

* БЭМ-проект всегда состоит хотя бы из одного уровня переопределения.
* Уровень переопределения содержит частичные или полные реализации блоков.
* Конечная реализация блока собирается с разных уровней переопределения.
* Для каждого случая можно настроить свое используемое множество уровней.

### БЭМ-проект всегда состоит хотя бы из одного уровня переопределения

В БЭМ-методологии реализация блока состоит из отдельных файлов технологий (`button.css`, `button.js`) — исходных файлов. Все исходные файлы проекта хранятся в группирующих директориях, если говорить в терминах БЭМ – на уровнях переопределения. 

Минимальное количество уровней переопределения в проекте – один. Максимальное – не ограничено. 

Пример файловой структуры БЭМ-проекта с одним уровнем переопределения:

```files
project/
    blocks/                # уровень переопределения с блоками проекта
        header/
            header.css    
            header.js
        footer/
            footer.css    
            footer.js
```

Пример файловой структуры БЭМ-проекта с двумя уровнями переопределения. Блоки проекта и отдельных страниц проекта:

```files
project/
    common.blocks/                # уровень переопределения с блоками проекта
        header/
            header.css    
            header.js
        footer/
            footer.css    
            footer.js
    pages/
        index/
            blocks/
                head/
                    head.css      # переопределили вид шапки на заглавной странице
        about/
            blocks/
                about-text/       # добавили новый блок
                    about-text.css
                
```

### Уровень переопределения содержит частичные или полные реализации блоков

Конечная реализация блока может храниться на одном уровне переопределения или разделяться по разным. Благодаря этому уровни решают следующие задачи:

* [Добавление новых блоков в проект](#)
* [Изменение реализации блока](#)

Реализацию блока на любом из уровней может быть изменена на других уровнях переопределения. Изменяемую реализацию блока будем в дальнейшем называть исходной, а измененную — финальной.

#### Добавление новых блоков в проект

С помощью уровней переопределения можно добавлять новые блоки в проект. 

Подключение в проект дополнительных БЭМ-сущностей с разных уровней переопределения позволяет избежать:

* Копирования кода новых блоков в проект 
* Создания новых сущностей, при необходимости изменить уже существующие.
* Изменения исходной реализации блока.

Самый распространенный случай добавления блоков — подключение сторонней библиотеки в проект.

##### Подключение сторонней библиотеки
Рассмотрим пример, в котором библиотека подключается в БЭМ-проект как отдельный уровень. Добавим блок `logo` из библиотеки в проект. 


```files
project/
    common.blocks/                      # уровень переопределения с блоками проекта
        button/
            button.css
            button.js
    library.blocks/                     # уровень переопределения c блоками библиотеки
        logo/                           # блок logo 
            logo.css                    
            logo.js
```

Последовательность подключения CSS-правил:

```css
@import "common.blocks/button/button.css";     /* CSS-правила блока button с уровня общих блоков проекта*/
@import "library.blocks/logo/logo.css";         /* CSS-правила блока logo с уровня библиотеки*/
```

#### Изменение существующей реализации блока

С помощью уровней переопределения можно: 
* добавлять новые свойства блоку (доопределять);
* изменять существующие свойства блока (переопределять). 

Рассмотрим на примере кнопки (блок `button`) из подключенной библиотеки:
* Доопределим блок — добавим новое свойство (тень).
* Переопределим блок — изменим существующее свойство (перекрасим кнопку в другой цвет).

В примере используется блок `button` из подключенной библиотеки, которая находится на уровне переопределения `librery.blocks`.

```files
project/
    library.blocks/                # уровень переопределения с подключенной библитекой
        button/
            button.css
            button.js
```

Исходная CSS-реализация блока `button`:

```css
/* Блок button в технологии CSS на уровне library.blocks */

.button {
    color: red;
    height: 24px;
}
```

![Красная кнопка](https://raw.githubusercontent.com/innabelaya/bem-docs/master/pics/button_red.png)

Чтобы добавить всем кнопкам проекта новое свойство (тень) и изменить существующее свойство (цвет), создадим блок `button` на другом уровне блоков проекта (`common`). Для этого создадим файл `button.css` на уровне `common` и напишем в него новые правила.

Файловая структура проекта с добавленным уровнем переопределения:

```files
project/
    common/                # уровень переопределения с блоками проекта
        button/
            button.css
    library.blocks/        # уровень переопределения подключенной библиотеки
        button/
            button.css     
            button.js
```

Новые CSS-правила:

```css
/* Блок button в технологии CSS на уровне common */

.button {
    color: green; /* Новый цвет кнопки */
    box-shadow: 0 0 10px rgba(0,0,0,0.5); /* Параметры тени */
}
```

В результате сборки реализация блока `button` будет состоять из исходных CSS-правил с уровня `library.blocks` и добавленных — с уровня `common`:

```css
@import "library.blocks/button/button.css";   /* Исходные CSS-правила с уровня библиотеки */
@import "common/button/button.css";    /* Особенности с уровня common*/
```

Пример CSS-файла показывает, что сначала применяются исходные правила, а потом добавляются особенности с других уровней. 

Повторяющееся свойство (`color`) будет переопределено (кнопка из красной превратится в зеленую), а новое свойство (`box-shadow`) — добавлено. Блоку `button` применится следующий набор свойств:

```css
.button {
    color: red;
    height: 24px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}
```

![Зеленая кнопка с тенью](https://raw.githubusercontent.com/innabelaya/bem-docs/master/pics/button_green_with-shadow.png)

В результате:
* у всех кнопок проекта изменился цвет и появилось новое свойство — тень;
* исходная реализация блока `button` не изменилась;
* изменения внесены в один файл, но применились ко всем кнопкам проекта.
* обновление библиотеки не затронет изменения блоков для проекта, так как библиотека находится на одном уровне переопределения, а специфические реализации (доработки) блоков — на другом.

> **Важно** Можно переопределять не только CSS-свойства блока, но и его [методы](https://ru.bem.info/methodology/js/#Работа-с-уровнями-переопределения) и шаблоны.  
В БЭМ-проекте любая технология реализации блока может быть пере- или доопределена. Подробнее читайте в разделе [Платформа](https://ru.bem.info/platform/bem-xjst/runtime/).


### Финальная реализация блока собирается с разных уровней переопределения

Количество уровней, с которых собирается финальная реализация блока, и порядок их подключения может быть любым.
Исходная реализация дополняется или перекрывается реализациями с каждого последующего уровня. Поэтому при сборке финального результата важно определить последовательность подключения уровней в проект. В сборку сначала должна попасть исходная реализация, а затем — изменения со всех уровней переопределения.

> Подробнее о [сборке БЭМ-проектов и порядке подключения БЭМ-сущностей в проект](https://ru.bem.info/methodology/build).

![схема работы уровней переопределения]()

В качестве примера рассмотрим разделение кода проекта на платформы.

##### Разделение проекта на платформы

В проекте, поддерживающем разные платформы (например, `mobile` и `desktop`), часть кода описывает общую функциональность и часть — специфичную для каждой платформы. Чтобы не копировать общий код для реализации каждой из платформ, используются уровни переопределения: 

Например обязательно указаьб

* common — общая реализация блоков для всех платформ;
* desktop — специфическая реализация блоков для настольных устройств;
* mobile — специфическая реализация блоков для мобильных устройств.

Рассмотрим на примере:

```files
project/
    common.blocks/
        button/
            button.css    # базовая CSS-реализация кнопки

    desktop.blocks/   
        button/
            button.css    # особенности кнопки для настольных устройств

    mobile.blocks/
        button/
            button.css    # особенности кнопки для мобильных устройств
```

При сборке в файл `desktop.css` попадут все базовые CSS-правила кнопки с уровня `common` и переопределенные правила с уровня `desktop`.

```css
@import "common.blocks/button/button.css";    /* Базовые CSS-правила */
@import "desktop.blocks/button/button.css";   /* Особенности desktop */
```

Файл `mobile.css` будет включать базовые CSS-правила кнопки с уровня `common` и переопределенные правила с уровня `mobile`.

```css
@import "common.blocks/button/button.css";    /* Базовые CSS-правила */
@import "mobile.blocks/button/button.css";    /* Особенности mobile */
```

теперь в зависимотсти от юзер агента можете отдавать ту или иную сборку. 

### Для каждого случая можно настроить свое используемое множество уровней

В одном проекте можно настраивать разные варианты сборки: например, сборка только отдельной страницы или платформы. 

Пример показывает сборку проекта для разных платформ:

![Уровни переопределения](https://cdn.rawgit.com/bem-site/bem-method/bem-info-data/method/build/build__levels.svg)










## Примеры использования уровней переопределения

С помощью уровней переопределения можно:

* [Подключать библиотеки](#Проект-и-библиотеки)
* [Выделять общие части реализаций блоков](#Изменения-в-типовых-проектах)
* [Разделять проект на платформы](#Разделение-проекта-на-платформы)
* [Создавать разные дизайны проекта](#Проект-и-дизайн)
* [Экспериментировать в рабочем проекте](#Проект-и-эксперименты)

### Подключение библиотеки

> Разделение по уровням переопределения позволяет сохранить изменения в блоках при обновлении библиотеки. 

Библиотека подключается в БЭМ-проект как отдельный уровень. Изменять (доопределять или переопределять) блоки из этой библиотеки под требования проекта необходимо на другом уровне. При сборке следует подключать исходную реализацию блоков с уровня библиотеки и измененную — с уровня проекта.

Когда выйдет новая версия библиотеки, обновление не затронет изменения блоков для проекта, так как библиотека находится на одном уровне переопределения, а специфические реализации (доработки) блоков — на другом.

Рассмотрим на примере блока `button`. Подключим библиотеку на отдельный уровень (`library.blocks`) в проект. Изменим исходную высоту кнопки (блок `button`) из библиотеки с 20px на 24px. Для этого переопределим CSS-правило для блока `button` на уровне проекта (`project.blocks`): 

```files
project/
    library.blocks/
        button/
            button.css    # CSS-реализация кнопки в библиотеке (высота 20px)

    project.blocks/
        button/
            button.css    # переопределение на уровне проекта (высота 24px)
```

Если в новой версии библиотеки изменится высота кнопок (например, станет 18px), после обновления в проекте для блока `button` в браузере все равно применится переопределенное правило — 24px.

### Разделение кода проекта на общую и специфичную части

* [Разделение проекта на платформы](#)
* [Разработка проектов, использующих общие блоки](#)
* [Создание разных тем оформления для проекта](#)

### 
#### Разработка одного проекта на основе другого /// фак

> * исправить ошибку в общем коде нужно один раз, правки применятся во все проекты.

С помощью уровней переопределения можно создавать новые сайты на базе существующих или добавлять похожие по структуре страницы в проект и при этом не копировать код. Достаточно отделить общий код на один уровень переопределения, а специфический каждой страницы или каждого сайта — на другой.

Что дают уровни в этом случае:
* нет необходимости копировать общую часть кода из проекта в проект;

Пример ниже показывает, что общий код для всех страниц проекта находится на одном уровне переопределения `common.blocks`, а специфические блоки для отдельных страниц — на другом уровне (`pages`). 

```files
project/                            
    common.blocks/                  # общие блоки для всего проекта
        head/
            head.css
            head.js
        foot/
            foot.css
        sidebar/
            sidebar.css
            sidebar.js
    pages/                          # специфика реализации для отдельных страниц
        index/
            head/
                head.css            
        about/
            about-text/             
                about-text.css
```

```
common.blocks/
    b1/
    b2/
project1/
    b1/
    b2/
    b3/

project2/
    b1/
    b2/
    b4/



#### Создание разных тем оформления проекта

Поведение и внешний вид проекта можно разделить на разные уровни переопределения. Это позволит создавать и переключать дизайны проекта без изменения бизнес-логики.

В примере код, отвечающий за внешний вид проекта, вынесен на отдельный уровень (`design`), а общая логика работы находится на уровне `common`.

```files
common/             # бизнес-логика проекта
    button/
    input/
    ...
design/             # внешний вид проекта
    alfa/           # дизайн проекта alfa
        button/
        input/
    beta/           # дизайн проекта beta
        button/
        input/
```

Для изменения внешнего вида проекта необходимо включить уровень с нужным дизайном в сборку./// не дизайн

насобирать кучу разных одновременно комбинируя то что есть

### Эксперименты в рабочем проекте

Уровни переопределения позволяют проводить A/B тестирование непосредственно в рабочем проекте. При этом существующий код проекта менять не нужно. 

Рассмотрим пример, когда проект уже запущен, а заказчик хочет внести изменения. Например, предлагает разные варианты отображения личного фото пользователей. Разработчик должен изменить все фотографии всех пользователей на всех страницах сайта, провести тестирование и выбрать наиболее подходящий вариант. 

Для решения подобных задач без уровней переопределения необходимо:
* найти все случаи использования блока `user-pic` на каждой странице (если блок встречается на странице 15 раз, а страниц на сайте 30, то случаев будет 450);
* написать для каждого случая условие проверки (`if`);  
    ```
      if (пользователь попал в эксперимент 'круг')
      {
      отобрази фотографии пользователей в круглыми;
      };
      if (пользователь попал в эксперимент 'квадрат')
      {
      отобрази фотографии пользователей в квадратными;
      };
    ```

* выбрать финальный вариант;
* удалить изменения для каждого случая на каждой странице;
* применить выбранные изменения для каждого случая.

Чтобы провести такое тестирование в БЭМ-проекте, достаточно создать отдельный уровень переопределения для каждого эксперимента.

```files
project/                    
    blocks/                 # блоки проекта
        user-pic/           # блок `user-pic`
        headr другие отступы
        user name - другой шрифт
        ...
    эксперименты/
        test-circle/        # уровень для эксперимента 'круг'
            user-pic/       # блок `user-pic` с измененными круглыми фотографиями 
        test-square/        # уровень для эксперимента 'квадрат'
            user-pic/       # блок `user-pic` с измененными квадратными фотографиями  
        test-n/             # уровень для любого нового эксперимента
            user-pic/       # блок `user-pic` с любыми новыми изменениями
```

Во время экспериментов код рабочего проекта не изменяется. 

Чтобы убрать из проекта неподходящий вариант, достаточно удалить директорию — уровень переопределения неудачного эксперимента.

> Также можно проводить эксперименты, меняя поведение блока или разметку страницы. Например, если необходимо добавить новые теги для обеспечения доступности сайта (a11y). В этом случае переопределяются шаблоны и JavaScript-код.


